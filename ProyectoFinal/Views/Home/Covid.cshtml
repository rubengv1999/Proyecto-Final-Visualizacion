@{
    ViewData["Title"] = "Avance del COVID-19 a nivel mundial";
}


<h1 class="display-4 text-center">@ViewData["Title"]</h1>
<div id="container"></div>


@section Scripts{

    <script>$(function () {
            getDataByDate('2020-07-04');
        });

        
        $(function () {
            $("#slider").slider();
        });
        
        function getDataByDate(date) {
            $.get("/Home/GetDataByDate?Date=" + date, function (countries) {
                loadMap(countries);
            });
        }

        function loadMap(countries) {
            var data = [];
            countries.forEach(pais => data.push({ name: pais.location, code3: pais.isoCode, value: pais.totalCases }));

            var mapData = Highcharts.geojson(Highcharts.maps['custom/world']);

            mapData.forEach(function (country) {
                country.id = country.properties['hc-key'];
            });

            Highcharts.wrap(Highcharts.Point.prototype, 'select', function (proceed) {
                proceed.apply(this, Array.prototype.slice.call(arguments, 1));
                var points = mapChart.getSelectedPoints();
                if (points.length) {
                    points.forEach(function (p) {
                        getDataByCountry(p.name);
                    });
                }
            });

            mapChart = Highcharts.mapChart('container', {
                title: {
                    text: null
                },
                colorAxis: {
                    min: 1,
                    type: 'logarithmic',
                    minColor: '#EEEEFF',
                    maxColor: '#000022',
                    stops: [
                        [0, '#EFEFFF'],
                        [0.67, '#4444FF'],
                        [1, '#000022']
                    ]
                },
                series: [{
                    data: data,
                    mapData: mapData,
                    joinBy: ['iso-a3', 'code3'],
                    name: 'Total Cases',
                    allowPointSelect: true,
                    cursor: 'pointer',
                    states: {
                        select: {
                            color: '#000000',
                            borderColor: 'black',
                            dashStyle: 'shortdot'
                        }
                    },
                    borderWidth: 0.5
                }]
            });

            mapChart.get('cr').select();
        }
        function getDataByCountry(country) {
            $.get("/Home/GetDataByCountry?Country=" + country, function (data) {
                console.log(data);
            });
        }</script>


}